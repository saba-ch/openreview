# Ralph Progress Log
Started: Fri Feb 20 19:12:04 CET 2026
---

## Codebase Patterns
- preload/index.ts exposes IPC calls via contextBridge; renderer accesses them as `window.electron.*`
- Declare `window.electron` types in src/renderer/electron.d.ts (included by tsconfig.web.json via `src/renderer/**/*`)
- React components live in src/renderer/components/; use Zustand selector pattern for store access
- parse-diff Change types: 'add' uses `ln` (newLine), 'del' uses `ln` (oldLine), 'normal' uses `ln1`/`ln2`
- ipcMain handlers are registered before createWindow() to ensure they're ready when renderer loads
- Use `electron-vite` for building: main/preload use SSR bundle mode, renderer uses standard Vite build
- electron-vite renderer root is `src/renderer/` — `index.html` script src must be relative (`./main.tsx`), not absolute (`/src/renderer/main.tsx`)
- `"type": "module"` in package.json is needed to avoid Node ESM warnings with `postcss.config.js`
- Typecheck command: run `bun run typecheck` (not `tsc` directly — bun resolves deps correctly)
- Build output goes to `out/` (electron-vite default), not `dist/`
- Zustand stores live in src/renderer/store/; use selector pattern `useStore(state => state.field)` for stable refs
- useCommentsStore keys comments as `${filePath}:${lineNumber}`; getCommentsForFile/getComment use get() for current state

## 2026-02-20 - US-005
- Created src/renderer/electron.d.ts: global Window interface augmentation with `window.electron` types
- Created src/renderer/components/Toolbar.tsx: toolbar with Open Folder, Refresh, Copy Review buttons (latter two disabled until repo loaded)
- Updated src/renderer/App.tsx: integrates Toolbar, handles openFolder/refresh/copyReview callbacks, shows LoadingSkeleton during fetch, 'Not a git repository' error on IPC failure, empty/loaded states
- Files changed: src/renderer/electron.d.ts, src/renderer/components/Toolbar.tsx, src/renderer/App.tsx
- **Learnings for future iterations:**
  - `window.electron` types must be declared in a .d.ts file under src/renderer/ so tsconfig.web.json picks them up
  - Any error from `window.electron.getRepoDiff()` is treated as "Not a git repository" — git commands fail with exit 128 for non-git dirs
  - Zustand setters (setLoading, setFiles, etc.) are stable refs — safe to list in useCallback deps
  - Browser verification skipped (no browser MCP tool configured)
---

## 2026-02-20 - US-004
- Created src/renderer/store/repo.ts: useRepoStore with rootPath, files, selectedFile, isLoading + setters
- Created src/renderer/store/comments.ts: useCommentsStore with comments record keyed by `${filePath}:${lineNumber}`
- useCommentsStore exposes: addComment, updateComment, deleteComment, markOutdated, getCommentsForFile, getComment
- Files changed: src/renderer/store/repo.ts, src/renderer/store/comments.ts
- **Learnings for future iterations:**
  - Run typecheck via `bun run typecheck` not raw `tsc` — bun resolves node_modules correctly for electron-vite projects
  - Zustand v5 `create<State>((set, get) => ...)` — same API as v4 for basic stores
  - getCommentsForFile and getComment are stable function refs that use get() internally; components must also subscribe to state.comments for reactivity
  - deleteComment uses destructuring `const { [key]: _removed, ...rest } = state.comments` to omit a key cleanly
---

## 2026-02-20 - US-003
- Implemented git operations in Electron main process
- Created src/main/git.ts: runGit helper, mapParsedFiles (parse-diff → DiffFile[]), getRepoDiff, stageFile, unstageFile
- Updated src/main/index.ts: added ipcMain handlers for GIT_DIFF, GIT_STAGE, GIT_UNSTAGE, OPEN_DIALOG
- Updated src/preload/index.ts: exposed openDialog, getRepoDiff, stageFile, unstageFile via contextBridge
- **Learnings for future iterations:**
  - parse-diff 'add' changes use `ln` for new line number; 'del' uses `ln` for old line number; 'normal' uses `ln1`/`ln2`
  - Hunk header is included as a DiffLine of type 'hunk-header' at the start of each hunk's lines array
  - The preload exposes `window.electron` API — renderer components should call these for all IPC
  - OPEN_DIALOG handler uses dialog.showOpenDialog with 'openDirectory' property, returns null if canceled
---

## 2026-02-20 - US-002
- Populated src/shared/types.ts with all required exported types and IPC constants
- Files changed: src/shared/types.ts
- **Learnings for future iterations:**
  - IPC channel constants are exported as `as const` strings, not enums
  - DiffLine.type uses a string union, not an enum
  - All downstream stories (US-003+) can import types from src/shared/types.ts
---

## 2026-02-20 - US-001
- Scaffolded Electron + React + Bun + Tailwind project from scratch
- Created: package.json, bunfig.toml, electron.vite.config.ts, tsconfig.json, tsconfig.node.json, tsconfig.web.json, tailwind.config.js, postcss.config.js
- Created: src/main/index.ts (BrowserWindow, loads renderer), src/preload/index.ts (contextBridge stub)
- Created: src/renderer/index.html, src/renderer/main.tsx, src/renderer/App.tsx, src/renderer/index.css
- Created: src/shared/types.ts (placeholder comment)
- **Learnings for future iterations:**
  - electron-vite handles main, preload, renderer as separate Vite builds
  - Renderer index.html script path must be relative, not absolute
  - Both `bun run build` and `bun run typecheck` pass cleanly
  - Branch: ralph/openreview-app created from main
---
